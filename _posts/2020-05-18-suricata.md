---
title: Configuring Suricata IPS as an effective firewall against selected security risks
tags: Suricata IPS IDS security
---
### Introduction to Suricata

[<img src="https://openisf.files.wordpress.com/2015/05/suricata_logo.jpg" width="250" height="200" style="float:right; padding:23px" />](https://openisf.files.wordpress.com/2015/05/suricata_logo.jpg) Suricata is a free and open source, mature, fast and robust network threat detection engine [[1](https://suricata-ids.org/)]. It analyzes all traffic in the firewall and searches for known attacks and anomalies. It was developed by the Open Information Security Foundation (OISF). The source code of the product can be accessed via the following Github address;
[https://github.com/OISF/suricata](https://github.com/OISF/suricata)



### Step 1 - Installing Suricata in Ubuntu 18.04

Rather than installing from source, we will use Personal Package Archives (PPA) for updating and installation the latest stable Suricata. This process can be simplified by using the Suricata Ubuntu packages [[2](https://redmine.openinfosecfoundation.org/projects/suricata/wiki/Ubuntu_Installation_-_Personal_Package_Archives_(PPA))].
```
sudo apt-get install software-properties-common
sudo add-apt-repository ppa:oisf/suricata-stable
sudo apt-get update
```
Then you can install the latest stable Suricata with:
```
sudo apt-get install suricata 
```
or for the Suricata package with build in (enabled) debugging!
```
sudo apt-get install suricata-dbg
```
### Step 2 - Getting Started - Initial Configuration

At the end of the installation, we can see the Suricata rules under this path: **/etc/suricata/rules/** .
In the next step, we will try to get the rules with **Emerging Threats** that is a repository for Snort and Suricata rules [[3](https://hackertarget.com/install-suricata-ubuntu-5-minutes/)].
```
wget http://rules.emergingthreats.net/open/suricata/emerging.rules.tar.gz
tar zxvf emerging.rules.tar.gz
sudo mkdir /var/lib/suricata/
sudo mv rules /var/lib/suricata/
```
We also need to check and edit the **/etc/suricata/suricata.yaml** file for additional configuration. Make sure every variable of the vars, address-groups and port-groups in the yaml file is set correctly for your needs.  You need to set the ip-address(es) of your local network at *HOME_NET*. It is recommended to set *EXTERNAL_NET* to **!$HOME_NET**. This way, every ip-address but the one set at *HOME_NET* will be treated as external [[4](https://redmine.openinfosecfoundation.org/projects/suricata/wiki/Basic_Setup)].
```
sudo nano /etc/suricata/suricata.yaml
```
Change the following lines:
```
HOME_NET: "your machine's ip address, for example mine is 192.168.56.0/24" 
EXTERNAL_NET: "!$HOME_NET"
```
Also, we will enable our rules of choice.  For this purposes we will enable the **/var/lib/suricata/rules/emerging-exploit.rules** . We will make this change on **/etc/suricata/suricata.yaml** file.
```
default-rule-path: /var/lib/suricata/rules

rule-files:
  - emerging-exploit.rules
```
### Step 3 â€“ Implementing rules for the DDoS

Any request from external networks will not match the IP address that home networks have and that we define. Therefore Suricata will describe this as an attack. For this purpose, we will try to understand how Suricata gives an alert on a possible SYN flood or DDoS. Therefore, in order to realize this scenario, we need to create our test rule as shown below;
```
sudo nano /etc/suricata/rules/test-ddos.rules
```
```
alert tcp any any -> $HOME_NET 80 (msg: "Possible DDoS attack"; flags: S; flow: stateless; threshold: type both, track by_dst, count 200, seconds 1; sid:1000001; rev:1;)
```
Then, we need to configure Suricata to include this rule. So, we also need to edit the Suricata configuration file and add the rules file under the **rule-files:** section.
```
sudo nano /etc/suricata/suricata.yaml
```
```
rule-files:
 - botcc.rules
 - ciarmy.rules
...
# - Custom Test rules
 - test-ddos.rules
```
